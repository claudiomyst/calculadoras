var a=jQuery.noConflict();a(document).ready((function(){function contarCasasDecimais(a){return a.toString().split(".")[1]?.length||0}function formataPorcentagem(a){return(a/100).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}a("#btn-toggle-menu").click((function(){a("body").hasClass("menu-active")?a("body").removeClass("menu-active"):a("body").addClass("menu-active")})),a(document).on("input",".only-numbers",(function(){this.value=this.value.replace(/[^0-9\.]/g,"")})),a(".numeric-field").on("keydown",(function(e){const t=function calculateStep(a){const e=(a.split(".")[1]||"").length;return e>0?1/Math.pow(10,e):1}(a(this).val());let s=parseFloat(a(this).val())||0;"ArrowUp"===e.key?(s+=t,a(this).val(s.toFixed(contarCasasDecimais(t))).trigger("change"),e.preventDefault()):"ArrowDown"===e.key&&(s-t>=0&&(s-=t,a(this).val(s.toFixed(contarCasasDecimais(t))).trigger("change")),e.preventDefault())})),setTimeout((()=>{!function animateItems(a,e=100){document.querySelectorAll(a).forEach(((a,t)=>{setTimeout((()=>{a.classList.add("show")}),t*e)}))}(".cards .card",60)}),200),a(document).on("click",".btn-copy-text",(function(){var e=a(this),t=a(this).data("input"),s=a("."+t);if(s.length>0){var o=a("<input>");a("body").append(o),s.is("input")?o.val(s.val()):s.is("div")&&o.val(s.text()),o.select(),document.execCommand("copy"),o.remove(),""!==o.val().trim()&&(e.find(".copied").fadeIn(200,(function(){e.addClass("active")})),setTimeout((function(){e.find(".copied").fadeOut(800,(function(){e.removeClass("active")}))}),1e3))}})),a(document).on("click",".copy-text",(function(){var e=a(this),t=a("<input>");t.val(e.text()),a("body").append(t),t.select(),document.execCommand("copy"),t.remove(),e.addClass("active"),setTimeout((function(){e.removeClass("active")}),1e3)})),a(".input-range").length>0&&a('input[name="aceito_perder"]').ionRangeSlider({grid:!0,postfix:"%",from:50,min:0,max:100,grid_num:4,hide_min_max:!0,force_edges:!0,step:1}),a(document).on("submit","#defesa-grid",(function(e){e.preventDefault();let t=a(this),s=parseFloat(a(this).find('input[name="entrada-contratos"]').val()),o=parseFloat(a(this).find('input[name="defesa-contratos"]').val()),n=parseFloat(a(this).find('input[name="entrada-price"]').val()),i=parseFloat(a(this).find('input[name="preco-atual"]').val());if(n<i)return void t.closest(".popup").find(".text-result-erro").html("<b>Atenção:</b> O preço atual (Mark Price) está acima do seu preço de entrada. Caso sua intenção seja fazer o Grid invertido, utilize a calculadora específica para esse cálculo.").addClass("show");t.closest(".popup").find(".text-result-erro").empty().removeClass("show");let d=((n*s+i*o)/(s+o)).toFixed(contarCasasDecimais(i)),r=s+o,l=Math.abs(100*(d/i-1));l=Math.round(1e3*l)/1e3,isNaN(d)?(a("#contratos-total").text("--"),a(".new-price-defesa").text("--").removeClass("has-value"),a("#distancia-percentual").text("--")):(a("#contratos-total").text(r.toFixed(contarCasasDecimais(s))),a(".new-price-defesa").text(d).addClass("has-value"),a("#distancia-percentual").text(l.toFixed(2)+"%"))})),a(document).on("submit change","#piramidagem",(function(e){e.preventDefault();let t=a(this),s=parseFloat(a(this).find('input[name="entrada-contratos"]').val()),o=parseFloat(a(this).find('input[name="contratos-adicionais"]').val()),n=parseFloat(a(this).find('input[name="entrada-price"]').val()),i=parseFloat(a(this).find('input[name="preco-atual"]').val());if(s&&o&&n&&i){if(n>i)return t.closest(".popup").find(".text-result-erro").html("<b>Atenção:</b> O preço atual (Mark Price) está abaixo do seu preço de entrada. Caso sua intenção seja defender sua posição, utilize a calculadora específica para esse cálculo.").addClass("show"),a(".nova-entrada").text("--").removeClass("has-value"),void a("#distancia-percentual").text("--");{t.closest(".popup").find(".text-result-erro").empty().removeClass("show");let e=((n*s+i*o)/(s+o)).toFixed(contarCasasDecimais(i)),d=Math.abs(100*(e/i-1));d=Math.round(1e3*d)/1e3,isNaN(e)?(a(".nova-entrada").text("--").removeClass("has-value"),a(".distancia-percentual").text("--")):(a(".nova-entrada").text(e).addClass("has-value"),a("#distancia-percentual").text(d.toFixed(2)+"%"))}}})),a(document).on("submit change","#alavancagem-forn",(function(e){e.preventDefault();let t=a(this),s=parseFloat(t.find('input[name="margem"]').val()),o=parseFloat(t.find('input[name="aceito_perder"]').val()),n=parseFloat(t.find('input[name="entrada"]').val()),i=parseFloat(t.find('input[name="stop_loss"]').val());if(s&&o&&n&&i){let a=s*o,e=Math.abs(100*(i/n-1));e=Math.round(1e3*e)/1e3;let d=100/e/(100/o);d=Math.abs(d).toFixed(1),t.closest("div.box-cards").find(".loss_per_trade").text(`${function formataDinheiro(a){return(a/100).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}(a)} USDT`),t.closest("div.box-cards").find(".pct_stop_loss").text("-"+e+"%"),t.closest("div.box-cards").find(".alavancagem-ideal").text(d+"X")}else t.closest("div.box-cards").find('input[name="contratos"]').val(""),t.closest("div.box-cards").find(".loss_per_trade").text("--"),t.closest("div.box-cards").find(".pct_stop_loss").text("--"),t.closest("div.box-cards").find(".alavancagem-ideal").text("--")})),a(document).on("change","#grid-planejado-forn",(function(e){e.preventDefault();let t=a(this),s=parseFloat(t.find('input[name="entrada"]').val()),o=parseFloat(t.find('input[name="contratos"]').val()),n=parseFloat(t.find('input[name="alavancagem"]').val()),i=parseFloat(t.find('input[name="taxa"]').val()),d=contarCasasDecimais(t.find('input[name="entrada"]').val());if(i=i||.002,!s||!o||!n)return a("#grid-resultado").find(".grid_entrada, .grid_valor, .prox_defesa, .margem, .contratos, .pl").text("--"),a("#grid-resultado").find("fieldset.defesas").slice(1).remove(),!1;let r=o*s/n;r*=1+i;let l=o*s/n*n,c=s*(1-1/n);a("#grid-resultado").find("fieldset.entrada .grid_entrada").html('<div class="copy-text">'+s.toFixed(d)+"</div> USDT"),a("#grid-resultado").find("fieldset.entrada .grid_valor").text(l.toFixed(2)+" USDT"),a("#grid-resultado").find("fieldset.entrada .prox_defesa").html('<div class="copy-text">'+c.toFixed(d)+"</div> USDT"),a("#grid-resultado").find("fieldset.entrada .margem").text(r.toFixed(2)+" USD"),a("#grid-resultado").find("fieldset.entrada .contratos").text(o),a("#grid-resultado").find("fieldset.defesas").slice(1).remove(),a("#info-recomenda").empty().removeClass("active")})),a(document).on("click","#add-defesa",(function(e){let t=parseFloat(a("#grid-resultado").find("fieldset.defesas:last-child").find("span.grid_entrada").text()),s=parseFloat(a("#grid-resultado").find("fieldset.defesas:last-child").find("span.prox_defesa").text()),o=parseFloat(a("#grid-resultado").find("fieldset.defesas:last-child").find("span.contratos").text()),n=a("fieldset.defesas").length,i=a("#entrada").val(),d=parseFloat(a("#alavancagem").val()),r=parseFloat(a("#taxa").val());if(r=r||.002,!t||!s||!o)return;let l=2*o,c=t*(1-1/d);c=c.toFixed(contarCasasDecimais(i));let p=(t*o+c*l)/(o+l);p=p.toFixed(contarCasasDecimais(i)),c=p*(1-1/d),c=c.toFixed(contarCasasDecimais(i)),o+=2*o;let u=Math.round(1e3*o)/1e3,m=u*p/d*d,v=p*u/d;v*=1+r;let f=v;f+=.4*f;let x=100*Math.abs(c/i-1);x=Math.round(1e3*x)/1e3,$novaDefesa=`\n<fieldset class="defesas">\n<legend>${n}º Defesa - Desvalorização real de <span class="pct_queda">${x.toFixed(2)}%</span> no valor do ativo.</legend>\n<button class="remove-defesa"></button>\n\n<div class="defesas-inner columns-6">\n<div class="col col-entrada">\n<div class="box-input">\n<div class="input_container">\n<label><span data-tooltip="Valor da sua nova entrada após realizar a defesa">Nova entrada:</span></label>\n<span><span class="grid_entrada"><div class="copy-text">${p}</div> USDT</span></span>\n</div>\n</div>\n</div>\n\n<div class="col col-valor">\n<div class="box-input">\n<div class="input_container">\n<label><span data-tooltip="Valor nocional da posição atual">Valor:</span></label>\n<span><span class="grid_valor">${m.toFixed(2)} USDT</span></span>\n</div>\n</div>\n</div>\n\n<div class="col col-margem">\n<div class="box-input">\n<div class="input_container">\n<label><span data-tooltip="O valor total da margem que estará usando">Margem:</span></label>\n<span><span class="margem">${v.toFixed(2)} USD</span></span>\n</div>\n</div>\n</div>\n<div class="col col-contratos">\n<div class="box-input">\n<div class="input_container">\n<label><span data-tooltip="Adicione mais ${l} contratos para realizar a defesa da posição">Contratos:</span></label>\n<span><span class="contratos">${u}</span></span>\n</div>\n</div>\n</div>\n\n<div class="col col-defesa">\n<div class="box-input">\n<div class="input_container">\n<label><span data-tooltip="Valor onde a defesa deverá ser realizada">Defender em:</span></label>\n<span><span class="prox_defesa"><div class="copy-text">${c}</div> USDT</span></span>\n</div>\n</div>\n</div>\n\n</div>\n</fieldset>`,n++,a("#grid-resultado").append($novaDefesa),a("#info-recomenda").html(`Sua operação estruturada cobre uma queda de <span class="percent">${x.toFixed(2)}%</span> no valor do ativo, resultando em um P&L não realizado de <span class="pl-nao-realizado">-${v.toFixed(2)} USDT</span>. Para garantir a possibilidade de utilizar hedge ou trava caso o ativo se desvalorize além do previsto, recomenda-se iniciar a operação com um capital mínimo de <span class="min">${f.toFixed(2)} USDT</span> disponível.`).addClass("active"),a("#remove-defesa").addClass("active")})),a(document).on("click",".remove-defesa",(function(e){a(this).closest("fieldset.defesas:not(.entrada)").remove(),a("#info-recomenda").empty().removeClass("active")})),a(document).on("submit","#equilibrio-hedge",(function(e){e.preventDefault();let t=a(this),s=parseFloat(a(this).find('input[name="num_contratos_long"]').val()),o=parseFloat(a(this).find('input[name="num_contratos_short"]').val()),n=parseFloat(a(this).find('input[name="hedge_preco_entrada_long"]').val()),i=parseFloat(a(this).find('input[name="hedge_preco_entrada_short"]').val()),d=(n*s-i*o)/(s-o),r=d.toFixed(contarCasasDecimais(n)),l=(i-d)/i*100,c=(10*((d-n)/n*100)).toFixed(1),p=(10*l).toFixed(1);if(c=formataPorcentagem(c),p=formataPorcentagem(p),t.closest(".popup").find(".text-result-erro").empty().removeClass("show"),a(".equilibrio").text("--").removeClass("has-value"),a(".porcentagem-long, .porcentagem-short").text("--"),s&&o&&n&&i){if(n<i)return t.closest(".popup").find(".text-result-erro").html("Sua entrada em (Short) está acima da sua entrada em (Long), o que provavelmente indica que você está com uma trava de lucro. Nesse caso, não há um ponto de equilíbrio entre suas operações.").addClass("show"),a(".equilibrio").text("∾").addClass("has-value").addClass("color-amarelo"),void a(".porcentagem-long, .porcentagem-short").text("--");if(s<o)return t.closest(".popup").find(".text-result-erro").html("<b>Atenção:</b> A operação de hedge desequilibrada, com mais contratos no short do que no long, é extremamente perigosa. Se o preço do ativo subir, o prejuízo no short pode ser infinito e levar à perda total do seu capital. Tome muito cuidado!").addClass("show"),a(".equilibrio").text(r).addClass("has-value"),a(".porcentagem-long").text(c+"%"),void a(".porcentagem-short").text(p+"%");if(s==o)return t.closest(".popup").find(".text-result-erro").html("Sua operação está travada: o valor que você perde no Long é o mesmo que ganha no Short. Dessa forma, não há um ponto de equilíbrio para sair dessas operações.").addClass("show"),a(".equilibrio").text("∾").removeClass("has-value").addClass("color-amarelo"),void a(".porcentagem-long, .porcentagem-short").text("--");a(".equilibrio").text(r).addClass("has-value"),a(".porcentagem-long").text(c+"%"),a(".porcentagem-short").text(p+"%")}}))}));